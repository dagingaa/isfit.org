<%form_for :room, @room, :url => { :action => "update" } do |@f|%>

	<h1>Roomreservation</h1>
	<!--Prints out a reservation table for each room -->
	<table cellpadding=10 border=0>
		<tr><td colspan="2"><caption><b><%=link_to "< Prev", :controller => "roombooking", :action =>"show", :id => "#{@week-1}_#{@year}"%> | WEEK <%=@week%> | <%=link_to "Next >", :controller => "roombooking", :action =>"show", :id => "#{@week+1}_#{@year}"%></b></caption></td></tr>
		<%i = 1
		@rooms.each do |room|%>

			<!--Splits the table to new row at every second reservation table-->
			<%if i%2==1%>
				<tr>
			<%end%>
				<td>	
					<table border="1" cellpadding="0" cellspacing="0">
						<caption><b><%=room.name%></b></caption>

						<!--Prints out the header: roomname and days -->
						<tr style="background:silver">
							<th></th>
							<%@days.each do |day|%>
							<th><%=day[1][0,3]%></th>
							<%end%>
						</tr>
						<% time_int = 0%>
						<%@times.each do |time| %>
							<tr>	
								<td width="45" height="20" align="center" style="background:silver"><%=@print_times[time_int]%>
									<%@days.each do |day|%>
										<%user_booked = @bookings[day[0]][time[0]][room.id]%>
										<td width="45" align="center">
											<%if user_booked != nil%>
												<%if user_booked == current_user.id%>
													<font size=1><%=link_to "del", :controller => "roombooking", :action => "remove", :id => "#{day[0]}_#{time[0]}_#{@week}_#{room.id}_#{@year}" %></font>
												<%else%>
													<%booked_user = LdapUser.get_by_id(user_booked) %>
													<font size="1" style="color:green;"><%= content_tag('span', "#{booked_user.firstname[0,1]}.#{booked_user.lastname[0,1]}", 
														"title" =>"#{booked_user.firstname} #{booked_user.lastname} , #{booked_user.unit.name}") %></font>
												<%end%>
											<%elsif @current_day == -1 and @current_week == @week%>
												<%if @current_time < time[2] and day[0]==6%>
													<%=@f.check_box("#{day[0]}_#{day[1]}_#{time[0]}_#{time[1]}_#{@week}_#{room.id}_#{room.name}_#{@year}")%>
												<%else%>
													<font size="1" style="color:red">X</font>
												<%end%>

											<%elsif (@current_day > day[0]) or (@current_day == day[0] and @current_time >= time[2]) and @current_week == @week%>
												<font size=1><span style="color:red;">X</span></font>

											<%else%>
												<%=@f.check_box("#{day[0]}_#{day[1]}_#{time[0]}_#{time[1]}_#{@week}_#{room.id}_#{room.name}_#{@year}")%>
											<%end%>
										</td>
									<%end%>
								</td>
							</tr>
							<%time_int = time_int +1%>
						<%end%>
					</table>
					<br>
				</td>
			<%if i%2==0%>
				</tr>
			<%end%>
		<%i += 1
		end%>
	</table>
	<%=submit_tag'Update'%>

<%end%>
