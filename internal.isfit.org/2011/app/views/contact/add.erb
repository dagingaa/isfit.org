
You are here: <%= link_to('List', {:action => 'index'}) %> > <%= params[:id] ? "Edit" : "Add" %>
<h1>
	<%= image_tag("icon/edit.png", :alt => " ", :title => "Delete") %>
	<%= params[:id] ? @contact.first_name+" "+@contact.last_name : "Add a new contact" %> 
</h1>

<% if @access_granted == true %>

<% 
  	form_for :contact, @contact, 
	:url => { :action => params[:id] ? "update" : "add", 
	:id => params[:id]  } do |f| 
%>
	
<div id="contact">
	<label for="first_name">First name:</label>	
		<%= f.text_field :first_name %><br />
	<label for="last_name">Last name:</label>	
		<%= f.text_field :last_name %><br />
	<label>Organization:</label> 				
		<%= f.text_field :organization %> <br />
	<label>Position:</label> 				
		<%= f.text_field :position %> <br />
	<br />
	<% if(params[:id]) %>
		<label>	Contact via:</label>
		<div style="margin-left: 140px">
		<% @contact_via.each do |cont_via| %>
		<%= link_to("#{cont_via.first_name}, #{cont_via.last_name}", 
			:controller => "contact", :action => "add", 
			:id=>cont_via.id ) %>
		<br />
		<% end %>
		
		<%= link_to("(edit)", 
			:controller => "contact", :action => "contact_relation", 
			:id=>@contact.id ) %>
		</div>
	<% end %>
	<br />
	<label for="phone1">Phone number 1:</label>	
		<%= f.text_field :phone1 %><br />
	<label for="phone2">Phone number 2:</label>	
		<%= f.text_field :phone2 %><br />
	<label>Fax:</label>							
		<%= f.text_field :fax %><br />
	<br />
	<label for="email">Email address:</label>	
		<%= f.text_field :email %><br />
	<br />
	<label>Address 1:</label>					
		<%= f.text_field :address1 %><br />
	<label>Address 2:</label>					
		<%= f.text_field :address2 %><br />
	<label>City:</label>						
		<%= f.text_field :city %><br />
	<label>ZIP code:</label>					
		<%= f.text_field :zip %><br />
	<label>Country:</label>						
		<%=select("contact", 
			 "country_id", @countries.collect {|p| [ p.name, p.id ] })%><br />
	<br />
	<label>Isfit responsible:</label>
	<select id="contact_isfit_responsible" name="contact[isfit_responsible]">
	<%
	# Printer alle fornavn
	@funker.each do |funk|
		selected = "";
		if((params[:id] && (funk.id == @contact.isfit_responsible.to_i)) or (funk.id == current_user.id and params[:id] == nil))
			selected = "selected"
		end
		%>
		<option value="<%=funk.id%>" <%=selected%>>
		<%=funk.lastname%>, <%=funk.firstname%>
		</option>
	<%end%>
	</select>
	<br />

	<% if(params[:id]) %>
		<div style="margin-left: 140px">
		(<a href="mailto:<%=@responsible.username
		%>@isfit.org"><%=@responsible.username%>@isfit.org</a>,
        <%=@responsible.phones %>)
		</div>
		<br />
		<label>Other's in touch:</label>
		<div style="margin-left: 140px">
		<% me = false %>
		<% @contact_responsibles.each do |r| 
				tmp_user = LdapUser.get_by_id(r.responsible_id)
				if(Integer(r.responsible_id) == Integer(@user.id))
					me = true
				end
		%>
			<%= tmp_user.firstname %> <%= tmp_user.lastname %>
			(<%=tmp_user.username%>)
			<br />
		<% end %>
		<%= link_to me==true ? "Remove me" : "Add me",
			:controller => "contact",
			:action => me==true ? "remove_me" : "add_me",
			:id => params[:id] %>
		</div>
		<br /><br />
	<% end %>

	<label>Status:</label>
		<%= select("contact", "status", 
		options={"Bare ta kontakt","Bare ta kontakt", 
		"Kontakt isfit ansvarlig", "Kontakt isfit ansvarlig"}) %>
	<br />	

	<%= submit_tag 'Submit',
		:value => @contact != nil ? "Save changes" : "Add contact" %>
</div>
<% end %>


<!-- COMMENTS AREA-->
<% if params[:id] %>
	<br />
	<div class="comment">
	<h3>Comments: </h3>
	<% @comments.each do |c| %>
    	<% author = LdapUser.get_by_id(c.isfit_user) %>
    	<span class="author"><%= author.firstname %> <%=author.lastname%>
    	(<%=c.registered_time.strftime('%d.%m.%Y %H:%M') %>) wrote: </span>
    	</span><br />
    <div class="comment"><%= c.comment_text %> </div><br />
	<% end %>


	<% form_for :comment, @comment, 
		:url => { :action => "comment_edit", :id => params[:id]} do |f| %>
	<%= hidden_field(:comment, :contact_id, :value => params[:id]) %>
	<%= hidden_field(:comment, :isfit_user, :value => @user.id) %>
	<%= text_area(:comment,:comment_text, :cols => 90, :rows => 3) %>
	<br>
	<%= submit_tag 'Create Comment' %>
	<br>
	</div>

	<% end %>
<%end %>

<% else %>
	<h2>Oooops... authorization to this person denied!</h2>
	Please contact the main responsible for this contact:<br /><br />
	<b><%=@responsible.firstname%> <%=@responsible.lastname%></b><br />
	<div style="margin-left: 10px">
	E-mail: <a href="mailto:<%=@responsible.username%>
		@isfit.org"><%=@responsible.username%>@isfit.org</a><br />
    Phone: <%=@responsible.phones %>
	</div>

	<br /> 
	<b>Other's in touch:</b>
	<div style="margin-left: 10px">
	<% me = false %>
	<% @contact_responsibles.each do |r| 
			tmp_user = LdapUser.get_by_id(r.responsible_id)
			if(Integer(r.responsible_id) == Integer(@user.id))
				me = true
			end
	%>
		<%= tmp_user.firstname %> <%= tmp_user.lastname %>
		(<%=tmp_user.username%>)
		<br />
	<% end %>
	<%= link_to me==true ? "Remove me" : "Add me",
		:controller => "contact",
		:action => me==true ? "remove_me" : "add_me",
		:id => params[:id] %>
	</div>
	<br /><br />


<% end %>
