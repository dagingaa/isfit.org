<%
prev_pos = @current_image_pos
unless @current_image_pos == 0
  prev_pos = @current_image_pos - 1
end

next_pos = @current_image_pos 
unless @total_images - 1  == @current_image_pos
  next_pos = next_pos + 1 
end
%>


Back to <%= link_to "Gallery", :action => "index" %>
<!-- Title !-->
<h1>ISFiT Album: <%= @album_name %></h2>


<table valign = "top"><tr><td>

<!-- Current image !-->
<table width="520px">
  <tr valign="bottom">
	<td style="width: 16px">
	    	<%form_for :album, @album, :url => { :action => :album}, :html => {:method => :get, :id => "no_padding"} do |s| %>
    		<%= s.hidden_field(:album_name, :value => @album_name) %>
			<%= s.hidden_field(:selected, :value => 0) %>
    		<%= image_submit_tag("icon/first.png", :title=>"First image", :height=>"16")%>
		  	<% end %>
	</td>
    <td style="width: 16px">
	    	<%form_for :album, @album, :url => { :action => :album}, :html => {:method => :get, :id => "no_padding"} do |s| %>
    		<%= s.hidden_field(:album_name, :value => @album_name) %>
			<%= s.hidden_field(:selected, :value => prev_pos) %>
    		<%= image_submit_tag("icon/prev.png", :title=>"Previous image", :height=>"16")%>
		  	<% end %>
	</td>
	<td style="width: 356px">&nbsp;</td>
	<td style="text-align: right" width="116">
	    	<%form_for :album, @album, :url => { :action => :album}, :html => {:method => :get, :id => "no_padding"} do |s| %>
    		<%= s.hidden_field(:album_name, :value => @album_name) %>
			<%= s.hidden_field(:selected, :value => next_pos) %>
    		<%= image_submit_tag("icon/next.png", :title => "Next Image")%>
		  	<% end %>
	</td>
    <td style="text-align: right; width: 16px;">
	    	<%form_for :album, @album, :url => { :action => :album}, :html => {:method => :get, :id => "no_padding"} do |s| %>
    		<%= s.hidden_field(:album_name, :value => @album_name) %>
			<%= s.hidden_field(:selected, :value => @total_images - 1) %>
    		<%= image_submit_tag("icon/last.png", :title=> "Last image")%>
		  	<% end %>
	</td>
  	<tr>
    <td colspan="5" cellpadding="0" cellspacing="0" border="0">
      <% image_info = @album.image_info(@current_image, @folder, @album_name) %>
	    	<%form_for :album, @album, :url => { :action => :album}, :html => {:method => :get, :id => "no_padding"} do |s| %>
    		<%= s.hidden_field(:album_name, :value => @album_name) %>
			<%= s.hidden_field(:selected, :value => next_pos) %>
    		<%= image_submit_tag(image_info[:url], :width=>"520px")%>
		  	<% end %>
	</td>
  </tr>

  <tr style="color: silver; margin-top:0px" valign="top">
	<td colspan="3"><%= image_info[:name] %></td>
	<td colspan="2" style="text-align: right"><%= @current_image_pos +1 %> / <%= @total_images %></td>
  </tr>


<!-- Navigator !-->
  <tr>
  <td colspan="5">
    <table cellspacing="0" CELLPADDING="1">
	  <tr>
		<td colspan="5"><br /><strong>Navigator</strong></td>
	  <tr>
	<% i = -2 %>
	<% @thumbs.each do |t| %>
		<% if i == 0 %>	
		<td width="100" height="90" valign="top" style="border: 1px solid navy;background: silver;text-align: center;">
		<% else %>
		<td width="100" height="90" valign="top" style="text-align: center;">
		<% end %>
		  <% unless t.nil? %>
	    	<%form_for :album, @album, :url => { :action => :album}, :html => {:method => :get} do |s| %>
    		<%= s.hidden_field(:album_name, :value => @album_name) %>	
			<%= s.hidden_field(:selected, :value => @current_image_pos + i) %>
    		<%= image_submit_tag(t)%>
		  	<% end %>
		  <% end %>
		 <% i = i + 1 %> 
		<td>
	<% end %>
	  </tr>
    </table>

    </td>
  </tr>
</table>

</td>

<!-- Comments !-->
<td valign="top">
<div class="comment">
<h2>Comments</h2>
<% @comments.each do |c| %>
	<% author = LdapUser.get_by_id(c.isfit_user) %>
        <span class="author" style="color: navy">
			<%=c.created_at.strftime('%d.%m.%Y %H:%M') %> - 
			<%= author.firstname %> <%=author.lastname%>
		</span><br />
    <%= c.text %><br /><br />

<% end %>

<%form_for :album, @album, :url => { :action => :comment}, :html => {:method => :post} do |s| %>
<%= s.hidden_field(:album_name, :value => @album_name) %>
<%= s.hidden_field(:selected, :value => @current_image_pos) %>
<%= s.hidden_field(:current_image, :value=> @current_image) %>
<span style="color:silver">Leave a new comment: </span><br />
<%= s.text_area(:comment, :value => "", :rows=> "2") %><br />
<%= submit_tag("Save")%>
<% end %>




